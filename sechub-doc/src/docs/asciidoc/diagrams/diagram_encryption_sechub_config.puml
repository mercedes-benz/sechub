@startuml

'Hide empty parts:
hide empty fields
hide empty methods

'You can find more examles at https://plantuml.com/class-diagram

database DB {

}

database EventBus{
}

package com.mercedesbenz.sechub.domain.administration.job {
    class EncryptionAdminRestController
}


package com.mercedesbenz.sechub.domain.schedule.job{
    class ScheduleSecHubJob{
        byte[] getEncryptedConfiguration()
    }
    
    class SecHubJobFactory{
    
    }
     
    class ScheduleSecHubJobEncryptionUpdateService{
        updateEncryptionData(int blockSizeToUpdate) 
    }
    
    class SecHubConfigurationModelAccess {
        resolveUnencryptedConfiguration(ScheduleSecHubJob job)
    }
    
     class SecHubJobRepository
    
}

package com.mercedesbenz.sechub.domain.schedule.encryption {

    class ScheduleRefreshEncryptionServiceSetupTriggerService
     
    class ScheduleRotateDataEncryptionTriggerService {
        triggerUpdateOfEncryptedData()
    }

    class ScheduleEncryptionService {
        applicationStarted()
        refreshEncryptionPoolAndLatestIdIfNecessary()
        encryptWithLatestCipher()
        String decryptToString(byte[] encrypted, Long encryptionPoolId, InitializationVector initialVector)
        ScheduleEncryptionResult rotateEncryption(byte[] data, Long oldCipherPoolId, InitializationVector oldInitialVector)
    }
    
    class ScheduleCipherPoolData {
    }
    
    class ScheduleCipherPoolDataRepository{
        
    }
    
    class ScheduleEncryptionPool
    
    class ScheduleEncryptionPoolFactory{
        
    }
    
    class ScheduleLatestCipherPoolIdResolver
    
   
    
    
}
package com.mercedesbenz.sechub.commons.encryption {
    
    class PersistentCipherFactory
    class PersistentCipher
    class EncryptionSupport
}

ScheduleRefreshEncryptionServiceSetupTriggerService --> ScheduleEncryptionService : triggers refresh

ScheduleEncryptionPool -- ScheduleCipherPoolData
ScheduleEncryptionService -> ScheduleLatestCipherPoolIdResolver: uses
ScheduleEncryptionService o-- ScheduleEncryptionPool

ScheduleEncryptionService -> EncryptionSupport: uses
ScheduleEncryptionService -> ScheduleEncryptionPoolFactory: uses

ScheduleEncryptionPoolFactory --> ScheduleEncryptionPool : creates
PersistentCipherFactory -> PersistentCipher: creates
ScheduleEncryptionPoolFactory -> PersistentCipherFactory: uses
ScheduleLatestCipherPoolIdResolver  -> ScheduleCipherPoolDataRepository
ScheduleEncryptionPoolFactory -- ScheduleCipherPoolDataRepository: uses
ScheduleEncryptionPool -- PersistentCipher

ScheduleCipherPoolDataRepository -- DB

SecHubConfigurationModelAccess -> ScheduleEncryptionService


SecHubConfigurationModelAccess -> ScheduleSecHubJob

SecHubJobFactory -> ScheduleSecHubJob: creates
SecHubJobFactory -> ScheduleEncryptionService : uses

ScheduleRotateDataEncryptionTriggerService -> ScheduleSecHubJobEncryptionUpdateService: calls
ScheduleSecHubJobEncryptionUpdateService -> ScheduleEncryptionService


ScheduleSecHubJobEncryptionUpdateService --> SecHubJobRepository
SecHubJobRepository --> ScheduleSecHubJob  


EncryptionAdminRestController  --> EventBus
EventBus --> ScheduleRefreshEncryptionServiceSetupTriggerService 
@enduml
